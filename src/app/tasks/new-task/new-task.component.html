<h2>Add Task</h2>
<form [formGroup]="taskForm" (ngSubmit)="onSubmit()">
  <p>
    <label for="title">Title</label>
    <input 
      type="text" 
      id="title" 
      formControlName="title" 
      [class.invalid]="isFieldInvalid('title')"
    />
    @if (isFieldInvalid('title')) {
      <div class="error-message">
        @if (hasError('title', 'required')) {
          <span>Title is required</span>
        }
        @if (hasError('title', 'minlength')) {
          <span>Title must be at least 3 characters</span>
        }
      </div>
    }
  </p>

  <p>
    <label for="summary">Summary</label>
    <textarea
      id="summary"
      rows="5"
      formControlName="summary"
      [class.invalid]="isFieldInvalid('summary')"
    ></textarea>
    @if (isFieldInvalid('summary')) {
      <div class="error-message">
        @if (hasError('summary', 'required')) {
          <span>Summary is required</span>
        }
        @if (hasError('summary', 'minlength')) {
          <span>Summary must be at least 10 characters</span>
        }
      </div>
    }
  </p>

  <div class="datetime-container">
    <p>
      <label for="due-date">Due Date</label>
      <input
        type="date"
        id="due-date"
        formControlName="dueDate"
        [min]="minDate"
        [class.invalid]="isFieldInvalid('dueDate')"
        (change)="onDateChange()"
      />
      @if (isFieldInvalid('dueDate')) {
        <div class="error-message">
          @if (hasError('dueDate', 'required')) {
            <span>Due date is required</span>
          }
        </div>
      }
    </p>

    <p>
      <label for="due-time">Due Time</label>
      <input
        type="time"
        id="due-time"
        formControlName="dueTime"
        [class.invalid]="isFieldInvalid('dueTime')"
      />
      @if (isFieldInvalid('dueTime')) {
        <div class="error-message">
          @if (hasError('dueTime', 'required')) {
            <span>Due time is required</span>
          }
          @if (hasError('dueTime', 'pastTime')) {
            <span>Time must be in the future for today</span>
          }
        </div>
      }
    </p>
  </div>

  @if (taskForm.errors?.['pastDateTime']) {
    <div class="error-message">
      <span>Due date and time must be in the future</span>
    </div>
  }

  <p class="actions">
    <button type="button" (click)="taskForm.reset({ dueTime: '12:00' })">Cancel</button>
    <button type="submit" [disabled]="taskForm.invalid">Create</button>
  </p>
</form>